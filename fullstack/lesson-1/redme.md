# 前端性能优化指标

## 前言
对于前端的性能话题，从来都没有断绝过。因为优化方式，琳琅满目，这个东西没有最好，只有更好。而且往往也是业务的繁杂程度去决定优化程度的。性能是我们关注的指标。它直接影响着我们的用户，同时也影响着产品本身。

## 背景
减少 FMP 首次有效渲染时间，目前网页渲染方式两种

	服务端渲染：直出渲染
	前端渲染：加载完 JS 资源 -->请求接口数据 -->执行脚本 --> 渲染 DOM
基于以上路径，如何缩短各个时间段，分析项目情况，前端渲染做提升

## 方案
### 一、vue 服务器端渲染 (SSR)
利用 node 中间层，在服务端处理 vue 组件，生成 DOM，详细见官网

### 二、加载资源
1. 减少单个 JS 文件体积，拆包、懒加载（路由，组件），移除无用代码
2. 减少JS下载时间：预先解析 DNS、Preload、Prefetch
3. 加载优先级
4. Service Worker 缓存静态资源
5. 使用 lazyload 和 placeholder 提升加载体验

### 三、请求接口
1. 接口数据输出在 html 上
2. 接口数据合并
3. 接口数据请求，在加载 JS 之前发出

### 四、执行脚本
- JS 设置 defer 和 async，dns-prefetch
- vue相关：
1. watcher 的数量控制
2. 模板里面的表达式与判断优化
3. 为 v-for 设置键值
4. v-if，v-show 的正确使用

### 五、渲染
1. 减少 DOM 层级嵌套
2. 优化 css 选择器层级，使用 BEM 名字，移除无用代码
3. 首屏 css 分离 （去掉外联 css）

### 六、构建打包
1. 使用动态 polyfill；
2. 使用 SplitChunksPlugin 拆分公共代码；
3. 正确地使用 Webpack 4.0 的 Tree Shaking；
4. 使用动态 import，切分页面代码，减小首屏 JS 体积；
5. 编译到 ES2015+，提高代码运行效率，减小体积；

### 七、其它优化
1. 在 HTML 内实现 Loading 态或者骨架屏（页面，组件）；
2. 优化无限列表性能 vue-virtual-scroll-list 和 vue-virtual-scroller 
3. 去掉不必要的插件，勿用牛刀杀鸡
4. 是否开启 gzip 压缩，服务器缓存，本地缓存，重点关注图片压缩
 

性能相关文章参考：
- [蚂蚁金服如何把前端性能监控做到极致?](https://www.infoq.cn/article/Dxa8aM44oz*Lukk5Ufhy "蚂蚁金服如何把前端性能监控做到极致?")
- [让老板虎躯一震的前端技术，KPI杀手](https://juejin.im/post/5c3ff18b6fb9a04a0a5f76aa#heading-0 "让老板虎躯一震的前端技术，KPI杀手")

